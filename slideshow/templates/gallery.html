<!DOCTYPE html>
<html lang="en">

<head>
    {% include "head.html" %}

    <!-- Custom styles -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/gallery.css') }}">

    <!-- SocketIO client js -->
    <script type="text/javascript" src="{{ url_for('static', filename='js/socket.io.js') }}"></script>
    <script type="text/javascript" charset="utf-8">
        console.log("Setting up socket!");
        var socket = io();

        // When the socket connects
        socket.on("connect", function () {
            console.log("Gallery connected.");
        });

        // Handle connection errors
        socket.on("connect_error", function (error) {
            console.log("Connection error:", error.message);
        });

        // Handle receiving a new image as binary data
        socket.on("new_image", function (data) {
            console.log('New image received as binary data', data);

            // Create a Blob from the binary data and generate a URL for the main image
            var img_main_blob = new Blob([data.filename], { type: "image/jpeg" });
            $("#img_main").attr("src", URL.createObjectURL(img_main_blob));
            $("#comment").text(data.comment);
        });

        // Handle gallery updates (binary data) via WebSocket
        socket.on("galupdate", function (data) {
            console.log("Gallery update received with binary data:", data);

            // Convert binary data to Blob objects and create URLs
            var img_tl_blob = new Blob([data.img_tl], { type: "image/jpeg" });
            var img_bl_blob = new Blob([data.img_bl], { type: "image/jpeg" });
            var img_tr_blob = new Blob([data.img_tr], { type: "image/jpeg" });
            var img_br_blob = new Blob([data.img_br], { type: "image/jpeg" });

            // Update the gallery image sources using object URLs
            $("#img_tl").attr("src", URL.createObjectURL(img_tl_blob));
            $("#img_bl").attr("src", URL.createObjectURL(img_bl_blob));
            $("#img_tr").attr("src", URL.createObjectURL(img_tr_blob));
            $("#img_br").attr("src", URL.createObjectURL(img_br_blob));
        });

        // Handle socket disconnection
        socket.on('disconnect', function() {
            console.log('Disconnected from server');
        });
    </script>
</head>

<body>

    <div class="container gallery-container">

        <h1>„Ç¶„Çß„Éá„Ç£„É≥„Ç∞„ÇÆ„É£„É©„É™„Éº, Hochzeitsgalerie, Wedding gallery</h1>
        <p class="page-description text-center">
            „Ç≠„É£„É≥„Éê„Çπ„Å´ÂÜôÁúü„ÇíË≤º„Çã, Postet Eure Bilder auf die Leinwand, post your photos to the screen üôÉ
        </p>

        <!-- Nested grid layout for 2 left, 1 big centered, and 2 right -->
        <div class="tz-gallery">
            <div class="row">

                <div class="col-md-3">
                    <div class="row">
                        <div class="col-md-12 col-small vcenter">
                            <img class="thumbnail" src="" alt="img upper left" id="img_tl">
                        </div>
                        <div class="col-md-12 col-small vcenter">
                            <img class="thumbnail" src="" alt="img lower left" id="img_bl">
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-large vcenter">
                    <img class="thumbnail" id="img_main" src="" alt="img center">
                </div>

                <div class="col-md-3">
                    <div class="row">
                        <div class="col-md-12 col-small vcenter">
                            <img class="thumbnail" src="" alt="img upper right" id="img_tr">
                        </div>
                        <div class="col-md-12 col-small vcenter">
                            <img class="thumbnail" src="" alt="img lower right" id="img_br">
                        </div>
                    </div>
                </div>

            </div>

        </div>

        <p id="comment" class="text-center comment">{{ comment }}</p>

    </div>

</body>

</html>
